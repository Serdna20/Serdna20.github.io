---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Chat An√≥nimo y L√≠nea de Apoyo - StopTheCycle">
    <section class="pt-12 pb-12 px-4">
        <div class="max-w-6xl mx-auto">
            <div class="text-center mb-12">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-5xl">üí¨</span>
                </div>
                <h1 class="text-4xl md:text-5xl font-bold text-primary mb-4">Chat An√≥nimo y Apoyo</h1>
                <p class="text-xl text-secondary max-w-2xl mx-auto">
                    Habla con seguridad. Nadie sabr√° qui√©n eres. Recibe orientaci√≥n profesional sin revelar tu identidad.
                </p>
            </div>

            <!-- Opciones principales -->
            <div class="grid md:grid-cols-2 gap-8 mb-12">
                <div class="bg-gradient-to-br from-green-500 to-teal-500 rounded-2xl p-8 text-white cursor-pointer hover:shadow-2xl transition-all" onclick="document.getElementById('chatbot-section').scrollIntoView({behavior: 'smooth'})">
                    <div class="text-5xl mb-4">ü§ñ</div>
                    <h2 class="text-2xl font-bold mb-3">Chat An√≥nimo Autom√°tico</h2>
                    <p class="mb-4">Obt√©n respuestas inmediatas a tus preguntas. Disponible 24/7, completamente an√≥nimo.</p>
                    <button class="bg-white text-green-600 px-6 py-3 rounded-full font-bold hover:bg-gray-100">
                        Iniciar Chat ‚Üí
                    </button>
                </div>

                <div class="bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-8 text-white cursor-pointer hover:shadow-2xl transition-all" onclick="document.getElementById('phone-lines').scrollIntoView({behavior: 'smooth'})">
                    <div class="text-5xl mb-4">üìû</div>
                    <h2 class="text-2xl font-bold mb-3">L√≠neas de Apoyo</h2>
                    <p class="mb-4">Habla con profesionales capacitados. Orientaci√≥n psicol√≥gica y legal personalizada.</p>
                    <button class="bg-white text-purple-600 px-6 py-3 rounded-full font-bold hover:bg-gray-100">
                        Ver L√≠neas ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Chatbot Section -->
    <section id="chatbot-section" class="py-12 px-4 bg-card">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold mb-6 text-center gradient-text">Chat An√≥nimo</h2>
            <p class="text-center text-secondary mb-8">
                Haz tus preguntas sin miedo. Este chat no guarda tu informaci√≥n personal.
            </p>

            <!-- Chat Interface -->
            <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden">
                <div class="bg-gradient-to-r from-green-500 to-teal-500 text-white p-4">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center mr-3">
                            <span class="text-2xl">ü§ñ</span>
                        </div>
                        <div>
                            <h3 class="font-bold">Asistente Virtual StopTheCycle</h3>
                            <p class="text-xs opacity-90">En l√≠nea ‚Ä¢ An√≥nimo</p>
                        </div>
                    </div>
                </div>

                <div id="chat-messages" class="h-96 overflow-y-auto p-6 space-y-4 bg-gray-50 dark:bg-gray-900">
                    <div class="flex items-start">
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                            <span class="text-white text-sm">ü§ñ</span>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-2xl rounded-tl-none p-4 shadow max-w-md">
                            <p class="text-secondary">
                                Hola, soy tu asistente virtual. Estoy aqu√≠ para ayudarte de forma <strong>100% an√≥nima y confidencial</strong>.
                            </p>
                        </div>
                    </div>

                    <div class="flex items-start">
                        <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                            <span class="text-white text-sm">ü§ñ</span>
                        </div>
                        <div class="bg-white dark:bg-gray-800 rounded-2xl rounded-tl-none p-4 shadow max-w-md">
                            <p class="text-secondary mb-3">¬øEn qu√© puedo ayudarte hoy?</p>
                            <div class="space-y-2">
                                <button class="quick-reply-btn w-full text-left bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 p-3 rounded-lg text-sm transition-colors" data-message="Creo que estoy viviendo violencia">
                                    üí≠ Creo que estoy viviendo violencia
                                </button>
                                <button class="quick-reply-btn w-full text-left bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 p-3 rounded-lg text-sm transition-colors" data-message="¬øC√≥mo puedo denunciar?">
                                    ‚öñÔ∏è ¬øC√≥mo puedo denunciar?
                                </button>
                                <button class="quick-reply-btn w-full text-left bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 p-3 rounded-lg text-sm transition-colors" data-message="Necesito un refugio">
                                    üè† Necesito un refugio
                                </button>
                                <button class="quick-reply-btn w-full text-left bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 p-3 rounded-lg text-sm transition-colors" data-message="Quiero ayudar a alguien">
                                    üíú Quiero ayudar a alguien
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex gap-2">
                        <input 
                            type="text" 
                            id="chat-input" 
                            placeholder="Escribe tu mensaje aqu√≠..." 
                            class="flex-1 px-4 py-3 rounded-full border border-gray-300 dark:border-gray-600 focus:outline-none focus:border-green-500 bg-white dark:bg-gray-700 text-primary"
                        />
                        <button id="send-btn" class="bg-green-500 text-white px-6 py-3 rounded-full font-bold hover:bg-green-600">
                            Enviar
                        </button>
                    </div>
                    <p class="text-xs text-secondary mt-2 text-center">
                        üîí Este chat no almacena informaci√≥n personal. Es 100% an√≥nimo.
                    </p>
                </div>
            </div>

            <div class="mt-6 bg-yellow-50 dark:bg-yellow-900/20 rounded-xl p-6">
                <h3 class="font-bold mb-2 text-yellow-800 dark:text-yellow-200">‚ö†Ô∏è Importante sobre el Chat</h3>
                <ul class="space-y-2 text-sm text-secondary">
                    <li>‚Ä¢ Este es un asistente autom√°tico orientativo, no reemplaza atenci√≥n profesional</li>
                    <li>‚Ä¢ Si est√°s en peligro inmediato, llama al 123</li>
                    <li>‚Ä¢ Para atenci√≥n personalizada, usa las l√≠neas telef√≥nicas abajo</li>
                    <li>‚Ä¢ El chat no guarda conversaciones ni datos personales</li>
                </ul>
            </div>
        </div>
    </section>

    <!-- L√≠neas Telef√≥nicas -->
    <section id="phone-lines" class="py-12 px-4">
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold mb-6 text-center gradient-text">L√≠neas de Apoyo Profesional</h2>
            <p class="text-center text-secondary mb-8">
                Habla con psic√≥logos, trabajadores sociales y abogados especializados
            </p>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- L√≠nea P√∫rpura -->
                <div class="bg-card rounded-xl p-6 border-l-4 border-purple-600 hover:shadow-xl transition-all">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-2xl">üíú</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">L√≠nea P√∫rpura</h3>
                            <a href="tel:155" class="text-2xl font-bold text-purple-600">155</a>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm text-secondary">
                        <p><strong>Atenci√≥n:</strong> Mujeres v√≠ctimas de violencia</p>
                        <p><strong>Horario:</strong> 24 horas, 7 d√≠as</p>
                        <p><strong>Servicios:</strong></p>
                        <ul class="ml-4 space-y-1">
                            <li>‚Ä¢ Orientaci√≥n psicol√≥gica</li>
                            <li>‚Ä¢ Asesor√≠a legal</li>
                            <li>‚Ä¢ Informaci√≥n sobre rutas de atenci√≥n</li>
                        </ul>
                        <p><strong>Cobertura:</strong> Bogot√° (aplica en otras ciudades con c√≥digos locales)</p>
                    </div>
                    <a href="tel:155" class="mt-4 block bg-purple-600 text-white text-center py-2 rounded-full font-semibold hover:bg-purple-700">
                        Llamar Ahora
                    </a>
                </div>

                <!-- Nacional -->
                <div class="bg-card rounded-xl p-6 border-l-4 border-orange-600 hover:shadow-xl transition-all">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-2xl">üìû</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">L√≠nea Nacional</h3>
                            <a href="tel:018000112137" class="text-xl font-bold text-orange-600">01800 112 137</a>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm text-secondary">
                        <p><strong>Atenci√≥n:</strong> Todas las v√≠ctimas de violencia</p>
                        <p><strong>Horario:</strong> 24 horas, 7 d√≠as</p>
                        <p><strong>Servicios:</strong></p>
                        <ul class="ml-4 space-y-1">
                            <li>‚Ä¢ Orientaci√≥n inmediata</li>
                            <li>‚Ä¢ Informaci√≥n sobre refugios</li>
                            <li>‚Ä¢ Conexi√≥n con autoridades</li>
                        </ul>
                        <p><strong>Cobertura:</strong> Todo Colombia</p>
                        <p><strong>Gratuita desde celular y fijo</strong></p>
                    </div>
                    <a href="tel:018000112137" class="mt-4 block bg-orange-600 text-white text-center py-2 rounded-full font-semibold hover:bg-orange-700">
                        Llamar Ahora
                    </a>
                </div>

                <!-- ICBF -->
                <div class="bg-card rounded-xl p-6 border-l-4 border-blue-600 hover:shadow-xl transition-all">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-2xl">üë∂</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">ICBF</h3>
                            <a href="tel:141" class="text-2xl font-bold text-blue-600">141</a>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm text-secondary">
                        <p><strong>Atenci√≥n:</strong> Protecci√≥n de ni√±os, ni√±as y adolescentes</p>
                        <p><strong>Horario:</strong> 24 horas, 7 d√≠as</p>
                        <p><strong>Servicios:</strong></p>
                        <ul class="ml-4 space-y-1">
                            <li>‚Ä¢ Denuncias de maltrato infantil</li>
                            <li>‚Ä¢ Restablecimiento de derechos</li>
                            <li>‚Ä¢ Protecci√≥n inmediata</li>
                        </ul>
                        <p><strong>Cobertura:</strong> Nacional</p>
                    </div>
                    <a href="tel:141" class="mt-4 block bg-blue-600 text-white text-center py-2 rounded-full font-semibold hover:bg-blue-700">
                        Llamar Ahora
                    </a>
                </div>

                <!-- Fiscal√≠a -->
                <div class="bg-card rounded-xl p-6 border-l-4 border-teal-600 hover:shadow-xl transition-all">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-teal-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-2xl">‚öñÔ∏è</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Fiscal√≠a</h3>
                            <a href="tel:122" class="text-2xl font-bold text-teal-600">122</a>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm text-secondary">
                        <p><strong>Atenci√≥n:</strong> Denuncias penales</p>
                        <p><strong>Horario:</strong> 24 horas, 7 d√≠as</p>
                        <p><strong>Servicios:</strong></p>
                        <ul class="ml-4 space-y-1">
                            <li>‚Ä¢ Recepci√≥n de denuncias</li>
                            <li>‚Ä¢ Apertura de investigaciones</li>
                            <li>‚Ä¢ Atenci√≥n en CAIVAS</li>
                        </ul>
                        <p><strong>Cobertura:</strong> Nacional</p>
                    </div>
                    <a href="tel:122" class="mt-4 block bg-teal-600 text-white text-center py-2 rounded-full font-semibold hover:bg-teal-700">
                        Llamar Ahora
                    </a>
                </div>

                <!-- Salud Mental -->
                <div class="bg-card rounded-xl p-6 border-l-4 border-indigo-600 hover:shadow-xl transition-all">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-2xl">üß†</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Salud Mental</h3>
                            <a href="tel:106" class="text-2xl font-bold text-indigo-600">106</a>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm text-secondary">
                        <p><strong>Atenci√≥n:</strong> Crisis emocionales y psicol√≥gicas</p>
                        <p><strong>Horario:</strong> 24 horas, 7 d√≠as</p>
                        <p><strong>Servicios:</strong></p>
                        <ul class="ml-4 space-y-1">
                            <li>‚Ä¢ Contenci√≥n emocional</li>
                            <li>‚Ä¢ Prevenci√≥n de suicidio</li>
                            <li>‚Ä¢ Orientaci√≥n psicol√≥gica</li>
                        </ul>
                        <p><strong>Cobertura:</strong> Bogot√°</p>
                    </div>
                    <a href="tel:106" class="mt-4 block bg-indigo-600 text-white text-center py-2 rounded-full font-semibold hover:bg-indigo-700">
                        Llamar Ahora
                    </a>
                </div>

                <!-- Defensor√≠a -->
                <div class="bg-card rounded-xl p-6 border-l-4 border-pink-600 hover:shadow-xl transition-all">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mr-3">
                            <span class="text-2xl">üë®‚Äç‚öñÔ∏è</span>
                        </div>
                        <div>
                            <h3 class="font-bold text-lg">Defensor√≠a del Pueblo</h3>
                            <a href="tel:018000914814" class="text-lg font-bold text-pink-600">01800 091 4814</a>
                        </div>
                    </div>
                    <div class="space-y-2 text-sm text-secondary">
                        <p><strong>Atenci√≥n:</strong> Derechos humanos y orientaci√≥n legal</p>
                        <p><strong>Horario:</strong> Lunes a viernes, 8am-5pm</p>
                        <p><strong>Servicios:</strong></p>
                        <ul class="ml-4 space-y-1">
                            <li>‚Ä¢ Asesor√≠a jur√≠dica gratuita</li>
                            <li>‚Ä¢ Defensa de derechos</li>
                            <li>‚Ä¢ Acompa√±amiento en procesos</li>
                        </ul>
                        <p><strong>Cobertura:</strong> Nacional</p>
                    </div>
                    <a href="tel:018000914814" class="mt-4 block bg-pink-600 text-white text-center py-2 rounded-full font-semibold hover:bg-pink-700">
                        Llamar Ahora
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Consejos para Llamar -->
    <section class="py-12 px-4 bg-card">
        <div class="max-w-4xl mx-auto">
            <h2 class="text-3xl font-bold mb-6 text-center gradient-text">Consejos para Llamar a una L√≠nea de Apoyo</h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-green-50 dark:bg-green-900/20 rounded-xl p-6">
                    <h3 class="font-bold mb-3 text-green-600">‚úÖ Prepara tu Llamada</h3>
                    <ul class="space-y-2 text-sm text-secondary">
                        <li>‚Ä¢ Busca un lugar privado y seguro</li>
                        <li>‚Ä¢ Ten a mano papel y l√°piz para anotar</li>
                        <li>‚Ä¢ No necesitas dar tu nombre real si no quieres</li>
                        <li>‚Ä¢ Puedes colgar en cualquier momento</li>
                        <li>‚Ä¢ No hay preguntas "tontas"</li>
                    </ul>
                </div>

                <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6">
                    <h3 class="font-bold mb-3 text-blue-600">üí¨ Qu√© Puedes Preguntar</h3>
                    <ul class="space-y-2 text-sm text-secondary">
                        <li>‚Ä¢ ¬øLo que vivo es violencia?</li>
                        <li>‚Ä¢ ¬øC√≥mo puedo denunciar?</li>
                        <li>‚Ä¢ ¬øD√≥nde hay refugios seguros?</li>
                        <li>‚Ä¢ ¬øQu√© pasa despu√©s de denunciar?</li>
                        <li>‚Ä¢ ¬øC√≥mo protejo a mis hijos?</li>
                        <li>‚Ä¢ ¬øD√≥nde busco ayuda legal gratuita?</li>
                    </ul>
                </div>
            </div>

            <div class="mt-6 bg-purple-50 dark:bg-purple-900/20 rounded-xl p-6">
                <h3 class="font-bold mb-3 text-purple-600">üîí Tu Llamada Es Confidencial</h3>
                <p class="text-secondary text-sm mb-2">
                    Las personas que atienden estas l√≠neas est√°n capacitadas y tienen el deber de:
                </p>
                <ul class="space-y-1 text-sm text-secondary ml-4">
                    <li>‚Ä¢ Mantener tu informaci√≥n privada</li>
                    <li>‚Ä¢ No juzgarte ni presionarte</li>
                    <li>‚Ä¢ Respetarte decisiones</li>
                    <li>‚Ä¢ Ofrecerte opciones, no √≥rdenes</li>
                    <li>‚Ä¢ Tratarte con dignidad y respeto</li>
                </ul>
            </div>
        </div>
    </section>

    <script>
        // Chatbot Logic
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');

        const responses = {
            'violencia': {
                text: 'Entiendo tu preocupaci√≥n. La violencia puede ser f√≠sica, psicol√≥gica, sexual, econ√≥mica o negligencia. ¬øPodr√≠as contarme un poco m√°s sobre tu situaci√≥n? Recuerda que estoy aqu√≠ para ayudarte sin juzgar.',
                options: ['Violencia f√≠sica', 'Violencia psicol√≥gica', 'Violencia econ√≥mica', 'No estoy seguro/a']
            },
            'denunciar': {
                text: 'Puedes denunciar en:\n‚Ä¢ Comisar√≠as de Familia (primera instancia)\n‚Ä¢ Fiscal√≠a (denuncia penal) - L√≠nea 122\n‚Ä¢ Polic√≠a Nacional - 123\n‚Ä¢ ICBF (si hay menores) - 141\n\n¬øQuieres saber qu√© documentos necesitas o c√≥mo es el proceso?',
                options: ['¬øQu√© documentos necesito?', '¬øC√≥mo es el proceso?', '¬øQu√© pasa despu√©s?']
            },
            'refugio': {
                text: 'Hay refugios seguros disponibles. Para proteger tu ubicaci√≥n, te recomiendo:\n\n1. Llamar a la L√≠nea Nacional: 01800 112 137\n2. L√≠nea P√∫rpura: 155\n3. Comisar√≠a de Familia de tu zona\n\nEllos te indicar√°n el refugio m√°s cercano de forma confidencial. ¬øEst√°s en situaci√≥n de peligro inmediato?',
                options: ['S√≠, estoy en peligro', 'No inmediatamente', 'Solo quiero informaci√≥n']
            },
            'ayudar': {
                text: 'Es admirable que quieras ayudar. Lo m√°s importante es:\n\n1. Cree y escucha sin juzgar\n2. NO confrontes al agresor\n3. Ofrece informaci√≥n de l√≠neas de ayuda\n4. Respeta sus tiempos y decisiones\n5. Mant√©n la confidencialidad\n\n¬øLa persona es menor de edad o adulto?',
                options: ['Es menor de edad', 'Es adulto/a', '¬øC√≥mo abordar el tema?']
            },
            'default': {
                text: 'Entiendo. ¬øHay algo espec√≠fico en lo que pueda ayudarte? Estoy aqu√≠ para orientarte sobre violencia intrafamiliar, procesos de denuncia, refugios, o simplemente escucharte.',
                options: ['Tipos de violencia', 'C√≥mo denunciar', 'Necesito refugio', 'Ayudar a alguien']
            }
        };

        function addMessage(text, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start' + (isUser ? ' justify-end' : '');
            
            if (isUser) {
                messageDiv.innerHTML = `
                    <div class="bg-green-500 text-white rounded-2xl rounded-tr-none p-4 shadow max-w-md">
                        <p>${text}</p>
                    </div>
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center ml-3 flex-shrink-0">
                        <span class="text-sm">üë§</span>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                        <span class="text-white text-sm">ü§ñ</span>
                    </div>
                    <div class="bg-white dark:bg-gray-800 rounded-2xl rounded-tl-none p-4 shadow max-w-md">
                        <p class="text-secondary whitespace-pre-line">${text}</p>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addOptions(options) {
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'flex items-start';
            
            const buttonsHtml = options.map(opt => 
                `<button class="quick-reply-btn w-full text-left bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 p-3 rounded-lg text-sm transition-colors" data-message="${opt}">
                    ${opt}
                </button>`
            ).join('');
            
            optionsDiv.innerHTML = `
                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3 flex-shrink-0 invisible">
                    <span class="text-white text-sm">ü§ñ</span>
                </div>
                <div class="space-y-2 max-w-md">
                    ${buttonsHtml}
                </div>
            `;
            
            chatMessages.appendChild(optionsDiv);
            
            // Add event listeners to new buttons
            optionsDiv.querySelectorAll('.quick-reply-btn').forEach(btn => {
                btn.addEventListener('click', () => handleMessage(btn.dataset.message));
            });
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('violencia') || lowerMessage.includes('maltrato') || lowerMessage.includes('abuso')) {
                return responses.violencia;
            } else if (lowerMessage.includes('denunc') || lowerMessage.includes('reportar')) {
                return responses.denunciar;
            } else if (lowerMessage.includes('refugio') || lowerMessage.includes('alojamiento') || lowerMessage.includes('casa')) {
                return responses.refugio;
            } else if (lowerMessage.includes('ayudar') || lowerMessage.includes('amiga') || lowerMessage.includes('familiar')) {
                return responses.ayudar;
            } else if (lowerMessage.includes('peligro') || lowerMessage.includes('emergencia') || lowerMessage.includes('urgente')) {
                return {
                    text: 'üö® Si est√°s en peligro INMEDIATO:\n\n‚Ä¢ Llama al 123 (Polic√≠a)\n‚Ä¢ Sal de tu casa si es seguro\n‚Ä¢ Ve a un lugar p√∫blico\n\n¬øPuedes llamar ahora?',
                    options: ['S√≠, puedo llamar', 'No puedo hablar', 'Ya pas√≥ el peligro']
                };
            }
            
            return responses.default;
        }

        function handleMessage(message) {
            if (!message.trim()) return;
            
            // Add user message
            addMessage(message, true);
            chatInput.value = '';
            
            // Simulate typing delay
            setTimeout(() => {
                const response = getBotResponse(message);
                addMessage(response.text);
                
                if (response.options) {
                    setTimeout(() => addOptions(response.options), 500);
                }
            }, 1000);
        }

        sendBtn?.addEventListener('click', () => handleMessage(chatInput.value));
        chatInput?.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') handleMessage(chatInput.value);
        });

        // Quick reply buttons
        document.querySelectorAll('.quick-reply-btn').forEach(btn => {
            btn.addEventListener('click', () => handleMessage(btn.dataset.message));
        });
    </script>
</Layout>